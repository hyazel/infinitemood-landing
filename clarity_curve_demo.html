<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Courbe Auto-Clarity - Démonstration</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background: #1a1c22;
            color: white;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            color: #FD9F29;
        }
        .controls {
            text-align: center;
            margin: 20px 0;
        }
        button {
            background: #FD9F29;
            color: #1a1c22;
            border: none;
            padding: 10px 20px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }
        button:hover {
            background: #E7A52F;
        }
        canvas {
            border: 1px solid #383030;
            background: #131314;
            display: block;
            margin: 20px auto;
        }
        .info {
            text-align: center;
            margin: 20px 0;
            color: #CB7889;
        }
        .params {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        .param {
            text-align: center;
        }
        .param label {
            display: block;
            margin-bottom: 5px;
            color: #F89B58;
        }
        .param input {
            background: #383030;
            color: white;
            border: 1px solid #4a4040;
            padding: 5px;
            border-radius: 3px;
            width: 80px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Courbe Auto-Clarity - Démonstration</h1>
        
        <div class="controls">
            <button onclick="startDemo()">Démarrer</button>
            <button onclick="stopDemo()">Arrêter</button>
            <button onclick="clearCanvas()">Effacer</button>
        </div>
        
        <div class="params">
            <div class="param">
                <label>Vitesse</label>
                <input type="number" id="speed" value="0.1" step="0.001" min="0.001" max="0.2">
            </div>
            <div class="param">
                <label>Amplitude</label>
                <input type="number" id="amplitude" value="0.3" step="0.05" min="0.05" max="0.5">
            </div>
            <div class="param">
                <label>Centre</label>
                <input type="number" id="center" value="0.5" step="0.1" min="0" max="1">
            </div>
            <div class="param">
                <label>Min</label>
                <input type="number" id="minValue" value="0.2" step="0.1" min="0" max="1">
            </div>
            <div class="param">
                <label>Max</label>
                <input type="number" id="maxValue" value="0.8" step="0.1" min="0" max="1">
            </div>
        </div>
        
        <canvas id="curveCanvas" width="1000" height="400"></canvas>
        
        <div class="info">
            <p>Courbe générée par le bruit de Perlin multi-octaves</p>
            <p>Valeurs actuelles: <span id="currentValues"></span></p>
        </div>
    </div>

    <script>
        // Classe AutoClarity simplifiée pour la démo
        class AutoClarityDemo {
            constructor() {
                this.isActive = false;
                this.time = 0;
                this.speed = 0.002;
                this.amplitude = 0.15;
                this.center = 0.5;
                this.minValue = 0.2;
                this.maxValue = 0.8;
                this.intervalId = null;
                
                this.canvas = document.getElementById('curveCanvas');
                this.ctx = this.canvas.getContext('2d');
                this.points = [];
                this.maxPoints = 1000;
            }
            
            perlinNoise(x, y = 0) {
                const octave1 = Math.sin(x * 0.3 + y * 0.2) * 0.4;
                const octave2 = Math.sin(x * 0.8 + y * 0.5) * 0.3;
                const octave3 = Math.sin(x * 1.5 + y * 0.9) * 0.2;
                const octave4 = Math.sin(x * 3.0 + y * 1.8) * 0.1;
                return (octave1 + octave2 + octave3 + octave4) / 1.0;
            }
            
            generateClarityValue() {
                const noiseValue = this.perlinNoise(this.time);
                const scaledValue = this.center + (noiseValue * this.amplitude);
                const clampedValue = Math.max(this.minValue, Math.min(this.maxValue, scaledValue));
                return Math.round(clampedValue * 1000) / 1000;
            }
            
            updateParams() {
                this.speed = parseFloat(document.getElementById('speed').value);
                this.amplitude = parseFloat(document.getElementById('amplitude').value);
                this.center = parseFloat(document.getElementById('center').value);
                this.minValue = parseFloat(document.getElementById('minValue').value);
                this.maxValue = parseFloat(document.getElementById('maxValue').value);
            }
            
            addPoint() {
                const value = this.generateClarityValue();
                this.points.push({
                    x: this.time * 100, // Échelle pour l'affichage
                    y: value,
                    time: this.time
                });
                
                // Limiter le nombre de points
                if (this.points.length > this.maxPoints) {
                    this.points.shift();
                }
                
                this.time += this.speed;
            }
            
            draw() {
                // Effacer le canvas
                this.ctx.fillStyle = '#131314';
                this.ctx.fillRect(0, 0, this.canvas.width, this.canvas.height);
                
                if (this.points.length < 2) return;
                
                // Dessiner la grille
                this.ctx.strokeStyle = '#383030';
                this.ctx.lineWidth = 1;
                
                // Lignes horizontales
                for (let i = 0; i <= 10; i++) {
                    const y = (this.canvas.height / 10) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(0, y);
                    this.ctx.lineTo(this.canvas.width, y);
                    this.ctx.stroke();
                }
                
                // Lignes verticales
                for (let i = 0; i <= 10; i++) {
                    const x = (this.canvas.width / 10) * i;
                    this.ctx.beginPath();
                    this.ctx.moveTo(x, 0);
                    this.ctx.lineTo(x, this.canvas.height);
                    this.ctx.stroke();
                }
                
                // Dessiner la courbe
                this.ctx.strokeStyle = '#FD9F29';
                this.ctx.lineWidth = 3;
                this.ctx.beginPath();
                
                const firstPoint = this.points[0];
                const startY = this.canvas.height - (firstPoint.y * this.canvas.height);
                this.ctx.moveTo(0, startY);
                
                for (let i = 1; i < this.points.length; i++) {
                    const point = this.points[i];
                    const x = (point.x % this.canvas.width);
                    const y = this.canvas.height - (point.y * this.canvas.height);
                    this.ctx.lineTo(x, y);
                }
                
                this.ctx.stroke();
                
                // Dessiner les limites min/max
                this.ctx.strokeStyle = '#CB7889';
                this.ctx.lineWidth = 1;
                this.ctx.setLineDash([5, 5]);
                
                // Ligne min
                const minY = this.canvas.height - (this.minValue * this.canvas.height);
                this.ctx.beginPath();
                this.ctx.moveTo(0, minY);
                this.ctx.lineTo(this.canvas.width, minY);
                this.ctx.stroke();
                
                // Ligne max
                const maxY = this.canvas.height - (this.maxValue * this.canvas.height);
                this.ctx.beginPath();
                this.ctx.moveTo(0, maxY);
                this.ctx.lineTo(this.canvas.width, maxY);
                this.ctx.stroke();
                
                this.ctx.setLineDash([]);
                
                // Dessiner le point actuel
                if (this.points.length > 0) {
                    const lastPoint = this.points[this.points.length - 1];
                    const x = (lastPoint.x % this.canvas.width);
                    const y = this.canvas.height - (lastPoint.y * this.canvas.height);
                    
                    this.ctx.fillStyle = '#FD9F29';
                    this.ctx.beginPath();
                    this.ctx.arc(x, y, 5, 0, 2 * Math.PI);
                    this.ctx.fill();
                }
                
                // Mettre à jour les valeurs affichées
                if (this.points.length > 0) {
                    const lastValue = this.points[this.points.length - 1].y;
                    document.getElementById('currentValues').textContent = 
                        `Valeur actuelle: ${lastValue.toFixed(3)} | Temps: ${this.time.toFixed(2)}`;
                }
            }
            
            start() {
                if (this.isActive) return;
                
                this.isActive = true;
                this.intervalId = setInterval(() => {
                    this.updateParams();
                    this.addPoint();
                    this.draw();
                }, 50); // Mise à jour plus rapide pour la démo
            }
            
            stop() {
                if (!this.isActive) return;
                
                this.isActive = false;
                if (this.intervalId) {
                    clearInterval(this.intervalId);
                    this.intervalId = null;
                }
            }
            
            clear() {
                this.points = [];
                this.time = 0;
                this.draw();
            }
        }
        
        // Instance globale
        const demo = new AutoClarityDemo();
        
        // Fonctions globales
        function startDemo() {
            demo.start();
        }
        
        function stopDemo() {
            demo.stop();
        }
        
        function clearCanvas() {
            demo.clear();
        }
        
        // Initialiser
        demo.draw();
    </script>
</body>
</html>
